<!DOCTYPE html>
<html lang="en">
<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Login ‚Äî QuickConvert</title>

<link rel="stylesheet" href="../css/style.css">

<style>

/* ===== PAGE LAYOUT (ISOLATED ONLY TO LOGIN PAGE) ===== */

body.login-page{
margin:0;
font-family:system-ui;
background:linear-gradient(135deg,#f6f7fb,#e9ecf5);
display:flex;
align-items:center;
justify-content:center;
height:100vh;
}

/* CARD */

.card{
width:380px;
background:white;
padding:36px;
border-radius:18px;
box-shadow:0 12px 40px rgba(0,0,0,.08);
}

.title{font-size:22px;font-weight:700;margin-bottom:4px}
.sub{color:#666;margin-bottom:22px;font-size:14px}

/* INPUT */

.input-wrap{position:relative}

.card input{
width:100%;
padding:12px;
margin-bottom:14px;
border-radius:10px;
border:1px solid #ddd;
font-size:14px;
}

.card input:focus{
outline:none;
border-color:#ff4d4d;
}

.eye{
position:absolute;
right:10px;
top:12px;
cursor:pointer;
opacity:.6;
}

/* BUTTON */

.btn{
width:100%;
padding:12px;
border-radius:10px;
border:none;
background:#ff4d4d;
color:white;
font-size:15px;
cursor:pointer;
transition:.2s;
}

.btn:hover{background:#e23d3d}

/* ERROR */

.error{
color:#e53935;
font-size:14px;
margin-top:6px;
display:none;
}

/* LINK */

.link{
font-size:14px;
color:#ff4d4d;
cursor:pointer;
margin-top:8px;
display:inline-block;
}

/* OTP PANEL */

.otp-panel{
margin-top:16px;
padding:14px;
border-radius:10px;
background:#fafafa;
border:1px solid #eee;
display:none;
}

/* TOAST */

.toast{
position:fixed;
bottom:20px;
left:50%;
transform:translateX(-50%);
background:#333;
color:white;
padding:10px 16px;
border-radius:8px;
opacity:.95;
animation:fade 2.5s forwards;
}

.toast.success{background:#2e7d32}

@keyframes fade{
0%{opacity:1}
80%{opacity:1}
100%{opacity:0}
}

.footer{
margin-top:14px;
font-size:14px;
text-align:center;
}

.footer a{
color:#ff4d4d;
text-decoration:none;
}

</style>

</head>

<body class="login-page">

<div class="card">

<div class="title">‚ö° QuickConvert</div>
<div class="sub">Login to continue</div>

<input id="email" placeholder="Email">

<div class="input-wrap">
<input id="password" type="password" placeholder="Password">
<span class="eye" onclick="togglePass()">üëÅ</span>
</div>

<button class="btn" onclick="login()">Login</button>

<div id="errorBox" class="error"></div>

<div class="link" onclick="openOTP()">Forgot password?</div>

<div id="otpPanel" class="otp-panel">

<b>Password Reset</b>

<input id="otpEmail" placeholder="Email">
<button class="btn" onclick="requestOTP()">Send OTP</button>

<input id="otpCode" placeholder="Enter OTP">
<input id="newPass" placeholder="New password">

<button class="btn" onclick="verifyOTP()">Reset Password</button>

</div>

<div class="footer">
New here? <a href="/register">Create account</a>
</div>

</div>

<script>

/* ===== REDIRECT IF ALREADY LOGGED IN ===== */

if(localStorage.getItem("token")){
  window.location.href="/";
}

/* ===== TOAST ===== */

function toast(msg, ok=false){
const t=document.createElement("div");
t.className="toast"+(ok?" success":"");
t.innerText=msg;
document.body.appendChild(t);
setTimeout(()=>t.remove(),2500);
}

/* PASSWORD TOGGLE */

function togglePass(){
const p=document.getElementById("password");
p.type=p.type==="password"?"text":"password";
}

/* ERROR UI */

function showError(msg){
const box=document.getElementById("errorBox");
box.innerText=msg;
box.style.display="block";
}

/* LOGIN */

async function login(){

document.getElementById("errorBox").style.display="none";

const email=document.getElementById("email").value.trim();
const password=document.getElementById("password").value.trim();

if(!email||!password){
showError("Fill all fields");
return;
}

try{

const res=await fetch("/api/login",{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({email,password})
});

const data=await res.json();

if(res.ok && data.token){

localStorage.setItem("token",data.token);
toast("Login successful!",true);

setTimeout(()=>window.location.href="/",800);

}else{
showError(data.message||"Login failed");
}

}catch{
showError("Server error");
}

}

/* OTP FUNCTIONS */

function openOTP(){
document.getElementById("otpPanel").style.display="block";
}

async function requestOTP(){

const email=document.getElementById("otpEmail").value.trim();
if(!email){toast("Enter email");return;}

const res=await fetch("/api/reset/send-otp",{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({email})
});

const data=await res.json();
toast(data.msg||"OTP sent",res.ok);
}

async function verifyOTP(){

const email=document.getElementById("otpEmail").value.trim();
const otp=document.getElementById("otpCode").value.trim();
const pass=document.getElementById("newPass").value.trim();

if(!email||!otp||!pass){toast("Fill all OTP fields");return;}

const res=await fetch("/api/reset/verify-reset",{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({email,otp,newPassword:pass})
});

const data=await res.json();

if(res.ok){
toast(data.msg||"Password reset",true);
document.getElementById("otpPanel").style.display="none";
}else{
toast(data.msg||"Invalid OTP");
}
}

</script>

</body>
</html>
